<h3 xmlns="http://www.w3.org/1999/html">Visualizar imagens ao vivo</h3>

<div style='text-align: center;'>
  <%= form_tag('/live', method: 'get') do %>
      <%= hidden_field_tag 'server_id', params[:server_id] %>
      <%= radio_button_tag :grid_size, '1', params[:grid_size] != '4' %>
      <%= label_tag :grid_size_1, 'Mosaico 1x1' %><br />
      <%= radio_button_tag :grid_size, '4', params[:grid_size] == '4' %>
      <%= label_tag :grid_size_4, 'Mosaico 2x2' %>
      <br>
      <%= submit_tag 'Aplicar' %>
  <% end %>
  <hr>
  <% if (server = Server::find_by_id(params[:server_id])) %>
      <table>
        <tr>
          <% for i in 0...(params[:grid_size] || 1).to_i %>
              <td>
                <label>
                  <select name="AxCameras_<%= i + 1 %>" onchange="AxVideoControl_<%= i + 1 %>_Start()">
                
  <% 100.times do %>
                    <option value="">Selecione uma câmera.cgdoucgaodcgedaocgedcagodcageaodcgogocdagcedgcaodecdoac</option>
                    <% server.cameras.each do |camera| %>
                        <option value="<%= camera.camera_id %>"><%= camera.label %></option>
  <% end %>
                    <% end %>
                  </select>
                </label>
                <br>
                <object classid='clsid:37BEA57F-131B-49C1-B6FB-6D9E78F41B19'
                        height='<%= 480 / (params[:grid_size] == '4' ? 2 : 1) %>'
                        width='<%= 640 / (params[:grid_size] == '4' ? 2 : 1) %>'
                        id='AxVideoControl_<%= i + 1 %>'
                        EnableJavaScript='true'
                        codebase='ADSDK.IVideoControl'>
                  <p>Plugin American Dynamics SDK não foi encontrado.<br/>
                    <a href='' onclick="popitup()">Clique aqui</a> para instruções de como instalá-lo.</p>
                </object>
                <script type="text/vbscript">
                  <!--
                  Sub AxVideoControl_<%= i + 1 %>_Start()
                      AxVideoControl_<%= i + 1 %>.SetPaneLayout "<?xml version='1.0' encoding='utf-8' ?><Layout xmlns='urn:VideoLayoutSchema' Name='1x1' Rows='1' Columns='1' AspectRatio='4:3'><Pane Id='0' RowSpan='1' ColumnSpan='1' RowNumber='0' ColumnNumber='0' IsMasterPane='true'/></Layout>"
                      AxVideoControl_<%= i + 1 %>.MediaStreamRender 0, "nvr://" & "<%= server.username %>" & ":" & "<%= server.password %>" & "@" & "<%= server.address %>" & "/media/" & (AxCameras_<%= i + 1 %>.value - 1) & "/video/0"
                      'AxVideoControl_<%= i + 1 %>.resize
                  End Sub
                -->
                </script>
              </td>
              <% if i > 0 and i == (params[:grid_size].to_i / 2) - 1 %>
                  </tr>
                  <tr>
              <% end %>
          <% end %>
          </tr>
          </table>
  <% else %>
      <p>Não há tabelas no banco de dados!</p>
  <% end %>
</div>
