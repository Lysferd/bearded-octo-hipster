<% if @warehouse %>
    <% /^(?<date>\d+-\d+-\d+)\s(?<time>\d+)/ =~ String(Time::new) %>
    <label>
      Data: <input type="text" name="StartDate" value="<%= date %>"/>
    </label>
    <label>
      Hora: <input type="text" name="StartTime" value="<%= time %>:00"/>
    </label>
    <label>
      Camera:
      <select name="AxCameras">
        <option value="">Selecione uma câmera.</option>
        <% @warehouse.servers.each do |server| %>
            <% server.cameras.each do |camera| %>
                <option value="<%= camera.camera_id %>|<%= server.address %>|<%= server.username %>|<%= server.password %>"><%= camera.label %></option>
            <% end %>
        <% end %>
      </select>
      <br>
    </label>
    <input type="button" value="Visualizar imagens gravadas" onclick="AxVideoControl_Start()"/>
    <hr>
    <object classid='clsid:37BEA57F-131B-49C1-B6FB-6D9E78F41B19'
            height='480'
            width='640'
            id='AxVideoControl'
            EnableJavaScript='true'
            codebase='ADSDK.IVideoControl'>
      <p>Plugin American Dynamics SDK não foi encontrado.<br/>
        <a href='vs3_plugin_setup.zip'>Clique aqui</a> para instalá-lo.</p>
    </object>
    <script type="text/vbscript">
      <!--
          Sub AxVideoControl_Start()
              arguments = Split(AxCameras.value, "|")
              camera_id = arguments(0) - 1
              address  = arguments(1)
              username = arguments(2)
              password = arguments(3)

              AxVideoControl.SetPaneLayout "<?xml version='1.0' encoding='utf-8' ?><Layout xmlns='urn:VideoLayoutSchema' Name='1x1' Rows='1' Columns='1' AspectRatio='4:3'><Pane Id='0' RowSpan='1' ColumnSpan='1' RowNumber='0' ColumnNumber='0' IsMasterPane='true'/></Layout>"
              'AxVideoControl.resize
              streamUri = "nvr://" & username & ":" & password & "@" & address & "/media/" & camera_id & "/video/0"
              startDateTime = Replace(StartDate.Value, "-", "") & Replace(StartTime.Value, ":", "") & "0200"
              Set vidControlEx = AxVideoControl.GetInterface("ADSDK.IStreamingPlayback")
              vidControlEx.OpenStreamEx 0, streamUri, startDateTime, false, false, 10000
              vidControlEx = NULL
          End Sub
      -->
    </script>
<% else %>
    <p>Servidor não existe no banco de dados!</p>
<% end %>